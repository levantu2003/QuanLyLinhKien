use master
go

CREATE DATABASE BanLinhKienDienTu
go

USE BanLinhKienDienTu
go

CREATE TABLE [NhaCungCap] (
	[MaNCC] NVARCHAR(11) NOT NULL UNIQUE,
	[TenNCC] NVARCHAR(255),
	[Sdt] NVARCHAR(11),
	[DiaChi] NVARCHAR(255),
	[Email] NVARCHAR(255),
	PRIMARY KEY([MaNCC])
);
GO

CREATE TABLE [PhieuNhap] (
	[MaPN] NVARCHAR(11) NOT NULL UNIQUE,
	[NgayNhap] DATE,
	[GiaNhap] FLOAT,
	[SoLuong] INT,
	[ThanhTien] FLOAT,
	[MaNCC] NVARCHAR(11),
	[MaSP] NVARCHAR(11),
	PRIMARY KEY([MaPN])
);
GO

CREATE TABLE [SanPham] (
	[MaSP] NVARCHAR(11) NOT NULL UNIQUE,
	[TenSP] NVARCHAR(255),
	[NgaySanXuat] DATE,
	[GiaNhap] FLOAT,
	[GiaBan] FLOAT,
	[TrangThai] INT,
	[MaLoai] NVARCHAR(11),
	PRIMARY KEY([MaSP])
);
GO

CREATE TABLE [LoaiSanPham] (
	[MaLoai] NVARCHAR(11) NOT NULL UNIQUE,
	[TenLoai] NVARCHAR(255),
	PRIMARY KEY([MaLoai])
);
GO

CREATE TABLE [GioHang] (
	[MaGH] NVARCHAR(11) NOT NULL UNIQUE,
	[SoLuong] INT,
	[ThanhTien] FLOAT,
	[MaKH] NVARCHAR(11),
	PRIMARY KEY([MaGH])
);
GO

CREATE TABLE [HoaDon_SanPham] (
	[MaHD] NVARCHAR(11) NOT NULL,
	[MaSP] NVARCHAR(11) NOT NULL,
	PRIMARY KEY([MaHD], [MaSP])
);
GO

CREATE TABLE [HoaDon] (
	[MaHD] NVARCHAR(11) NOT NULL UNIQUE,
	[DonViTinh] NVARCHAR(255),
	[DonGia] FLOAT,
	[SoLuong] INT,
	[ThanhTien] FLOAT,
	[NgayXuatHD] DATE,
	[MaKH] NVARCHAR(11),
	[MaNV] NVARCHAR(11),
	PRIMARY KEY([MaHD])
);
GO

CREATE TABLE [KhachHang] (
	[MaKH] NVARCHAR(11) NOT NULL UNIQUE,
	[TenKH] NVARCHAR(255),
	[DiaChi] NVARCHAR(255),
	[Sdt] NVARCHAR(11),
	[GioiTinh] NVARCHAR(5),
	PRIMARY KEY([MaKH])
);
GO

CREATE TABLE [ChucVu] (
	[MaCV] NVARCHAR(11) NOT NULL UNIQUE,
	[TenCV] NVARCHAR(255),
	PRIMARY KEY([MaCV])
);
GO

CREATE TABLE [NhanVien] (
	[MaNV] NVARCHAR(11) NOT NULL UNIQUE,
	[Sdt] NVARCHAR(11),
	[DiaChi] NVARCHAR(255),
	[NgaySinh] DATE,
	[GioiTinh] NVARCHAR(5),
	[MaCV] NVARCHAR(11),
	PRIMARY KEY([MaNV])
);
GO

CREATE TABLE [ThongKePhieuNhap] (
	[MaTKPN] NVARCHAR(11) NOT NULL UNIQUE,
	[SoLuongDaNhap] INT,
	[TongSoTienNhap] FLOAT,
	[TongDonGiaNhap] FLOAT,
	[MaNV] NVARCHAR(11),
	PRIMARY KEY([MaTKPN])
);
GO

CREATE TABLE [ThongKeHoaDon] (
	[MaTKHD] NVARCHAR(11) NOT NULL UNIQUE,
	[NgayBan] DATE,
	[SoLuongDaBan] INT,
	[TongDonGiaBan] FLOAT,
	[TongGiaBan] FLOAT,
	[MaNV] NVARCHAR(11),
	PRIMARY KEY([MaTKHD])
);
GO

CREATE TABLE [NguoiDung] (
	[MaND] NVARCHAR(11) NOT NULL UNIQUE,
	[Email] NVARCHAR(255),
	[MatKhau] NVARCHAR(255),
	PRIMARY KEY([MaND])
);
GO

CREATE TABLE [NguoiDung_PhanQuyen] (
	[MaND] NVARCHAR(11) NOT NULL,
	[MaPQ] NVARCHAR(11) NOT NULL,
	PRIMARY KEY([MaND], [MaPQ])
);
GO

CREATE TABLE [PhanQuyen] (
	[MaPQ] NVARCHAR(11) NOT NULL UNIQUE,
	[TenNhomQuyen] NVARCHAR(255),
	PRIMARY KEY([MaPQ])
);
GO

CREATE TABLE [ChiTietPhanQuyen] (
	[MaCTPQ] NVARCHAR(11) NOT NULL UNIQUE,
	[QuyenDuocCapPhep] NVARCHAR(255),
	[KiemTraHanhDong] INT,
	[MaPQ] NVARCHAR(11),
	PRIMARY KEY([MaCTPQ])
);
GO

CREATE TABLE [SanPham_Gio] (
	[MaSP] NVARCHAR(11) NOT NULL,
	[MaGH] NVARCHAR(11) NOT NULL,
	PRIMARY KEY([MaSP], [MaGH])
);
GO

ALTER TABLE [HoaDon_SanPham]
ADD FOREIGN KEY([MaHD]) REFERENCES [HoaDon]([MaHD])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [NguoiDung_PhanQuyen]
ADD FOREIGN KEY([MaND]) REFERENCES [NguoiDung]([MaND])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [NguoiDung_PhanQuyen]
ADD FOREIGN KEY([MaPQ]) REFERENCES [PhanQuyen]([MaPQ])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [PhieuNhap]
ADD FOREIGN KEY([MaNCC]) REFERENCES [NhaCungCap]([MaNCC])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [PhieuNhap]
ADD FOREIGN KEY([MaSP]) REFERENCES [SanPham]([MaSP])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [SanPham]
ADD FOREIGN KEY([MaLoai]) REFERENCES [LoaiSanPham]([MaLoai])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [SanPham_Gio]
ADD FOREIGN KEY([MaSP]) REFERENCES [SanPham]([MaSP])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [SanPham_Gio]
ADD FOREIGN KEY([MaGH]) REFERENCES [GioHang]([MaGH])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [GioHang]
ADD FOREIGN KEY([MaKH]) REFERENCES [KhachHang]([MaKH])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [HoaDon_SanPham]
ADD FOREIGN KEY([MaSP]) REFERENCES [SanPham]([MaSP])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [HoaDon]
ADD FOREIGN KEY([MaKH]) REFERENCES [KhachHang]([MaKH])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [NhanVien]
ADD FOREIGN KEY([MaCV]) REFERENCES [ChucVu]([MaCV])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [HoaDon]
ADD FOREIGN KEY([MaNV]) REFERENCES [NhanVien]([MaNV])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [ThongKeHoaDon]
ADD FOREIGN KEY([MaNV]) REFERENCES [NhanVien]([MaNV])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [ThongKePhieuNhap]
ADD FOREIGN KEY([MaNV]) REFERENCES [NhanVien]([MaNV])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO
ALTER TABLE [ChiTietPhanQuyen]
ADD FOREIGN KEY([MaPQ]) REFERENCES [PhanQuyen]([MaPQ])
ON UPDATE NO ACTION ON DELETE CASCADE;
GO

-- NhaCungCap
INSERT INTO NhaCungCap (MaNCC, TenNCC, Sdt, DiaChi, Email) 
VALUES 
('NCC001', N'Công ty Linh Kiện ABC', '0123456789', N'123 Đường XYZ, Hà Nội', 'abc@gmail.com'),
('NCC002', N'Công ty Điện Tử 123', '0987654321', N'456 Đường PQR, TP HCM', '123@yahoo.com');

-- LoaiSanPham  
INSERT INTO LoaiSanPham (MaLoai, TenLoai)
VALUES
('LSP001', N'IC'),
('LSP002', N'Transistor'),
('LSP003', N'Điện trở');

-- SanPham
INSERT INTO SanPham (MaSP, TenSP, NgaySanXuat, GiaNhap, GiaBan, TrangThai, MaLoai)
VALUES
('SP001', N'IC 7400', '2023-01-01', 5000, 10000, 1, 'LSP001'),  
('SP002', N'Transistor C1815', '2023-02-01', 2000, 5000, 1, 'LSP002'),
('SP003', N'Điện trở 1K', '2023-03-01', 500, 1000, 1, 'LSP003');

-- PhieuNhap
INSERT INTO PhieuNhap (MaPN, NgayNhap, GiaNhap, SoLuong, ThanhTien, MaNCC, MaSP)
VALUES
('PN001', '2023-04-01', 5000, 100, 500000, 'NCC001', 'SP001'),
('PN002', '2023-04-02', 2000, 200, 400000, 'NCC002', 'SP002');

-- ChucVu
INSERT INTO ChucVu (MaCV, TenCV) 
VALUES
('CV001', N'Quản lý'),
('CV002', N'Nhân viên bán hàng');

-- NhanVien
INSERT INTO NhanVien (MaNV, Sdt, DiaChi, NgaySinh, GioiTinh, MaCV)
VALUES  
('NV001', '0123456789', N'Hà Nội', '1990-01-01', N'Nam', 'CV001'),
('NV002', '0987654321', N'TP HCM', '1995-02-02', N'Nữ', 'CV002');

-- KhachHang
INSERT INTO KhachHang (MaKH, TenKH, DiaChi, Sdt, GioiTinh)
VALUES
('KH001', N'Nguyễn Văn A', N'Hà Nội', '0123456789', N'Nam'), 
('KH002', N'Trần Thị B', N'TP HCM', '0987654321', N'Nữ');

-- GioHang
INSERT INTO GioHang (MaGH, SoLuong, ThanhTien, MaKH) 
VALUES
('GH001', 2, 20000, 'KH001'),
('GH002', 1, 5000, 'KH002');

-- SanPham_Gio
INSERT INTO SanPham_Gio (MaSP, MaGH)
VALUES  
('SP001', 'GH001'),
('SP002', 'GH002');

-- HoaDon
INSERT INTO HoaDon (MaHD, DonViTinh, DonGia, SoLuong, ThanhTien, NgayXuatHD, MaKH, MaNV)
VALUES
('HD001', N'Cái', 10000, 2, 20000, '2023-05-01', 'KH001', 'NV002'),  
('HD002', N'Cái', 5000, 1, 5000, '2023-05-02', 'KH002', 'NV002');

-- HoaDon_SanPham  
INSERT INTO HoaDon_SanPham (MaHD, MaSP)
VALUES
('HD001', 'SP001'),
('HD002', 'SP002');

INSERT INTO NguoiDung (MaND, Email, MatKhau)
VALUES 
('ND001', 'user1@example.com', '7c6a180b36896a0a8c02787eeafb0e4c'),
('ND002', 'user2@example.com', '6cb75f652a9b52798eb6cf2201057c73');

INSERT INTO PhanQuyen (MaPQ, TenNhomQuyen)
VALUES
('PQ001', N'Quản trị viên'),  
('PQ002', N'Nhân viên');

INSERT INTO NguoiDung_PhanQuyen (MaND, MaPQ)
VALUES
('ND001', 'PQ001'),
('ND002', 'PQ002');  

INSERT INTO ChiTietPhanQuyen (MaCTPQ, QuyenDuocCapPhep, KiemTraHanhDong, MaPQ)
VALUES  
('CTPQ001', N'Xem báo cáo', 1, 'PQ001'),
('CTPQ002', N'Thêm sản phẩm', 1, 'PQ002');

INSERT INTO ThongKeHoaDon (MaTKHD, NgayBan, SoLuongDaBan, TongDonGiaBan, TongGiaBan, MaNV)  
VALUES
('TKHD001', '2023-05-31', 10, 100000, 1000000, 'NV002');

INSERT INTO ThongKePhieuNhap (MaTKPN, SoLuongDaNhap, TongSoTienNhap, TongDonGiaNhap, MaNV)
VALUES  
('TKPN001', 50, 2500000, 50000, 'NV001');
